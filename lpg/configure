#!/bin/sh

CONFIG=configure.make

echo "Configurating Makefile for LPG..."

echo "# -------- This file has been automatically generated by configure ---------" > $CONFIG

TARGET="lpg"
#CFLAGS="-O3  -D__MY_OUTPUT__ -DNDEBUG  -Wall"
CFLAGS="-O3  -DNDEBUG  -Wall"

LIBS=" -lm "

if [ $# -gt 0 ]; then
while [ TRUE ]; do
  if [ $# -le 0 ]; then
    break
  fi

  if test `echo $1 | head -c 1` = "-" &>/dev/null
    then
    case $1 in
	("-windebug") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g  -Wall -D__WINLPG__"
	    TARGET="winlpg-debug"
	fi
        shift;;

	("-win") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-O3  -DNDEBUG  -Wall -D__WINLPG__"
	    TARGET="winlpg"
	fi
        shift;;


	("-ipc4") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-O3  -DNDEBUG  -Wall -D__ONLY_ONE_PLANNER__"
	    TARGET="lpg"
	fi
        shift;;

	("-ipc4debug") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g  -D__MY_OUTPUT__  -Wall -D__ONLY_ONE_PLANNER__"
	    TARGET="lpg-debug"
	fi
        shift;;

	("-debug") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g -D__MY_OUTPUT__ -Wall"
	    TARGET="lpg-debug"
	fi
        shift;;

	("-debuglm") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g -D__MY_OUTPUT__ -D__LOW_MEM__  -Wall"
	    TARGET="lpg-debug"
	fi
        shift;;

        ("-debuglazza")
        if [ $# -eq 1 ]; then
            CFLAGS="-g -D__MY_OUTPUT__ -Wall -DTEST_LAZZA"
            TARGET="lpg-debug-lazza"
        fi
        shift;;

        ("-test") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-O1 -D__MY_OUTPUT__ -DNDEBUG -Wall"
	    TARGET="lpg-test"
	fi
        shift;;

	("-test06")
        if [ $# -eq 1 ]; then
            CFLAGS="-O6  -D__MY_OUTPUT__ -DNDEBUG -Wall"
            TARGET="lpg-test"
        fi
        shift;;

	("-testS")
        if [ $# -eq 1 ]; then
            CFLAGS="-Os  -D__MY_OUTPUT__ -DNDEBUG -Wall"
            TARGET="lpg-testS"
        fi
        shift;;

        ("-dtest") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g -D__MY_OUTPUT__ -Wall -D__TEST__ "
	    TARGET="lpg-dtest"
	fi
        shift;;

        ("-efence") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-g -D__MY_OUTPUT__ -DNDEBUG -D__EFENCE__ "
	    LIBS=" -lm -lefence"
	    TARGET="lpg-ef"
	fi
        shift;;

        ("-gprof") 
	if [ $# -eq 1 ]; then
	    CFLAGS="-pg -Wall  -D__MY_OUTPUT__"
	    TARGET="lpg-pg"
	fi
        shift;;

    ("-probing")
    if [ $# -eq 1 ]; then
        CFLAGS="-O3 -DNDEBUG -Wall"
        TARGET="lpg-probing"
    fi
    shift;;

	("-CFLAGS")
	CFLAGS=""
	shift
	while [ $# -gt 0 ]; do
	    if [ $1 = "-TARGET" ]; then
		shift
		TARGET=$1
		shift
		continue
	    fi
	    if [ $1 = "-test" ] || [ $1 = "-debug" ]; then
		shift
	    else
		CFLAGS="$CFLAGS $1"
		shift
	    fi
	    done
	;;

	("-TARGET")
	shift
	TARGET=$1
	shift;;

        ("-h") HELP=1
	echo "Option for configure:"
	echo -e "[] \t\tTARGET=\"lpg\"\t\tCFLAGS=\"-O3 -DNDEBUG  -Wall\""
	echo -e "[-debug]\tTARGET=\"lpg-debug\"\tCFLAGS=\"-g -D__MY_OUTPUT__ -Wall\""
	echo -e "[-test]\t\tTARGET=\"lpg-test\"\tCFLAGS=\"-O1 -D__MY_OUTPUT__ -DNDEBUG -Wall\""
	echo -e "[-dtest]\tTARGET=\"lpg-dtest\"\tCFLAGS=\"-g -D__MY_OUTPUT__ -Wall -D__TEST__ \""
	echo -e "[-efence]\tTARGET=\"lpg-ef\"\t\tCFLAGS=\"-g -D__MY_OUTPUT__ -DNDEBUG -D__EFENCE__\""
	echo -e "[-gproof]\tTARGET=\"lpg-pg\"\t\tCFLAGS=\"-g -Wall  -D__MY_OUTPUT__\""
    echo -e "[-probing]\tTARGET=\"lpg-probing\"\t\tCFLAGS=\"-O3 -DNDEBUG -Wall\""
	echo -e "[-CFLAGS]\tCflags"
	echo -e "[-TARGET]\tTarget"
	exit
	shift;;
        esac
    fi
done
fi

echo -e "Configure Makefile for $TARGET: $CFLAGS"

echo "TARGET = $TARGET" >> $CONFIG
echo "CFLAGS = $CFLAGS" >> $CONFIG
echo "LIBS= $LIBS">> $CONFIG
make clean
make
